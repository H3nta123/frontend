import{E as P,m as i,F as y,G as g,am as _}from"./index-BaQgaqTq.js";const k=P("products",()=>{const a=i([]),c=i(null),l=i(!1),t=i(null),u=i(0),h=i(1),f=i(20),m=y(()=>a.value.filter(r=>r.status==="active")),F=y(()=>a.value.filter(r=>r.status==="draft"));async function S(r){l.value=!0,t.value=null;try{if(a.value.length>0){u.value=a.value.length;return}const o=new URLSearchParams;r?.page&&o.set("page",String(r.page)),r?.limit&&o.set("limit",String(r.limit));const s=await g.get(`/goods?${o.toString()}`);a.value=s.data,u.value=s.total,h.value=s.page,f.value=s.limit}catch(o){t.value=o.message||"Ошибка загрузки товаров",console.error("fetchProducts error:",o)}finally{l.value=!1}}async function C(r){l.value=!0,t.value=null;try{const o=a.value.find(s=>s.id===r);if(o)return c.value=o,o;try{const s=await g.get(`/goods/${r}`);return c.value=s,s}catch{return console.warn("Could not fetch product via API, returning null"),null}}catch(o){return t.value=o.message||"Ошибка загрузки товара",console.error("fetchProductById error:",o),null}finally{l.value=!1}}function v(r){a.value=r,u.value=r.length}async function p(r){l.value=!0,t.value=null;try{const o=await g.post("/goods",r);return a.value.push(o),o}catch(o){return t.value=o.message||"Ошибка создания товара",console.error("createProduct error:",o),null}finally{l.value=!1}}async function T(r,o){l.value=!0,t.value=null;try{const s=await g.patch(`/goods/${r}`,o),b=a.value.findIndex(x=>x.id===r);return b!==-1&&(a.value[b]=s),s}catch(s){return t.value=s.message||"Ошибка обновления товара",console.error("updateProduct error:",s),null}finally{l.value=!1}}async function e(r){l.value=!0,t.value=null;try{return await g.delete(`/goods/${r}`),a.value=a.value.filter(o=>o.id!==r),!0}catch(o){return t.value=o.message||"Ошибка удаления товара",console.error("deleteProduct error:",o),!1}finally{l.value=!1}}function n(){c.value=null}return{products:a,currentProduct:c,loading:l,error:t,total:u,page:h,limit:f,activeProducts:m,draftProducts:F,fetchProducts:S,fetchProductById:C,createProduct:p,updateProduct:T,deleteProduct:e,clearCurrentProduct:n,setProducts:v}}),d={name:"Мой Магазин",subdomain:"",logoUrl:"",primaryColor:"#4527A0",secondaryColor:"#7C4DFF",backgroundColor:"#FFFFFF",textColor:"#212121",heroTitle:"Добро пожаловать в наш магазин",heroSubtitle:"Лучшие товары по лучшим ценам",heroImage:"",heroButtonText:"Смотреть каталог",heroStyle:"centered",heroOverlay:!1,fontFamily:"'Inter', sans-serif",showProductsSection:!0,productsTitle:"Популярные товары",showAboutSection:!1,aboutText:"",cardLayout:"grid-standard",footerText:"© 2026 Все права защищены",socialLinks:{}},w=[{id:"minimal-light",name:"Минимализм",description:"Чистый светлый дизайн с акцентом на товары",preview:"",category:"minimal",settings:{...d,primaryColor:"#000000",secondaryColor:"#666666",backgroundColor:"#FFFFFF",textColor:"#212121",heroTitle:"Новая коллекция",heroSubtitle:"Откройте для себя стильные новинки сезона",heroButtonText:"Смотреть",heroStyle:"centered",cardLayout:"grid-standard"}},{id:"modern-purple",name:"Модерн",description:"Современный фиолетовый стиль с градиентами",preview:"",category:"modern",settings:{...d,primaryColor:"#7C4DFF",secondaryColor:"#E040FB",backgroundColor:"#FAFAFA",textColor:"#212121",heroTitle:"Будь в тренде",heroSubtitle:"Эксклюзивные товары для тех, кто ценит стиль",heroButtonText:"Исследовать",heroStyle:"left",cardLayout:"grid-compact"}},{id:"dark-elegant",name:"Тёмная элегантность",description:"Премиальный тёмный дизайн для люксовых брендов",preview:"",category:"dark",settings:{...d,primaryColor:"#FFD700",secondaryColor:"#FFA500",backgroundColor:"#121212",textColor:"#FFFFFF",heroTitle:"Эксклюзив",heroSubtitle:"Премиальные товары для взыскательных клиентов",heroButtonText:"Открыть каталог",heroStyle:"centered",heroOverlay:!0,cardLayout:"list-view"}},{id:"classic-blue",name:"Классика",description:"Классический синий дизайн, вызывающий доверие",preview:"",category:"classic",settings:{...d,primaryColor:"#1976D2",secondaryColor:"#42A5F5",backgroundColor:"#FFFFFF",textColor:"#37474F",heroTitle:"Качество и надёжность",heroSubtitle:"Проверенные товары с гарантией качества",heroButtonText:"В каталог",heroStyle:"right",cardLayout:"grid-standard"}},{id:"eco-green",name:"Эко-стиль",description:"Природные оттенки для экологичных брендов",preview:"",category:"modern",settings:{...d,primaryColor:"#4CAF50",secondaryColor:"#8BC34A",backgroundColor:"#F1F8E9",textColor:"#33691E",heroTitle:"Товары от природы",heroSubtitle:"Экологически чистые продукты для вашего дома",heroButtonText:"Выбрать",heroStyle:"centered",cardLayout:"list-view"}},{id:"coral-fresh",name:"Свежий коралл",description:"Яркий и свежий стиль для молодежных брендов",preview:"",category:"modern",settings:{...d,primaryColor:"#FF6B6B",secondaryColor:"#FFA726",backgroundColor:"#FFFBF5",textColor:"#2D3436",heroTitle:"Стиль без границ",heroSubtitle:"Яркие вещи для ярких людей",heroButtonText:"Вперёд!",heroStyle:"left",cardLayout:"grid-compact"}}],I=P("shop",()=>{const a=localStorage.getItem("shop_settings"),c=localStorage.getItem("shop_theme_id"),l=i(c||"minimal-light"),t=i(a?JSON.parse(a):{...d}),u=i([]),h=k(),f=y(()=>{const e=t.value.backgroundColor.toLowerCase();return e==="#121212"||e==="#000000"||e==="#1a1a1a"}),m=y(()=>w.find(e=>e.id===l.value)||w[0]),F=e=>{const n=w.find(r=>r.id===e);n&&(l.value=e,t.value={...n.settings},localStorage.setItem("shop_theme_id",e))},S=e=>{t.value={...t.value,...e}},C=()=>{localStorage.setItem("shop_settings",JSON.stringify(t.value)),localStorage.setItem("shop_theme_id",l.value)},v=async()=>{try{const e=A();if(!e)return;const n=await g.get(`/render?slug=${e}`);n&&(n.config?t.value={...t.value,...n.config}:n.settings&&(t.value={...t.value,...n.settings}),n.products&&Array.isArray(n.products)?(u.value=n.products,h.setProducts(n.products)):n.data?.products&&(u.value=n.data.products,h.setProducts(n.data.products)),n.pattern&&(l.value=n.pattern))}catch(e){console.error("Failed to fetch site config:",e)}};window.location.host.split(".").length>2&&window.location.host.startsWith("localhost");const p=window.location.host;return(p.includes("localhost:3000")?p.split(".").length>=2:p.split(".").length>2)&&v(),_(t,e=>{localStorage.setItem("shop_settings",JSON.stringify(e))},{deep:!0}),window.addEventListener("storage",e=>{e.key==="shop_settings"&&e.newValue&&(t.value=JSON.parse(e.newValue)),e.key==="shop_theme_id"&&e.newValue&&(l.value=e.newValue)}),{settings:t,products:u,currentThemeId:l,isDarkTheme:f,currentTheme:m,applyTheme:F,updateSettings:S,saveSettings:C,fetchSiteConfig:v}});function A(){const a=window.location.host;if(a.includes("localhost:3000")){const c=a.split(".");if(c.length>2)return c[0]}return null}const L=(a,c)=>{const l=a.__vccOpts||a;for(const[t,u]of c)l[t]=u;return l};export{w as T,L as _,I as a,k as u};
