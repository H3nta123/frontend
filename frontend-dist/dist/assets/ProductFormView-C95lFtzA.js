import{d as j,F as V,ad as z,m as I,$ as M,B as K,c as n,V as O,w as s,b as o,x as h,s as P,h as y,y as U,a,g as x,v as q,L as W,K as Z,e as F,f as c,n as p,t as f,a6 as H,J as Q,I as X,j as Y,i as ee,ae as B,C as N,A as te,o as r,Z as ae,af as le,k as oe,l as se}from"./index-BaQgaqTq.js";import{M as de}from"./MainLayout-cmQcMttl.js";import{u as re,_ as ie}from"./_plugin-vue_export-helper-C_lUuKz4.js";const ne={class:"d-flex align-center justify-space-between mb-6"},ue={class:"d-flex align-center"},me={class:"text-h5 font-weight-bold"},ce={class:"d-flex gap-2"},pe={key:1,class:"d-flex justify-center py-16"},fe={class:"pa-6"},be={class:"pa-6"},ge={key:0,class:"d-flex flex-wrap gap-3 mb-4"},ve={class:"d-flex gap-2 mb-2"},ye={class:"pa-6"},xe={class:"pa-6"},Ve={class:"d-flex justify-space-between align-center",style:{"max-width":"300px"}},ke={class:"pa-6"},we={class:"pa-6"},Ie=j({__name:"ProductForm",setup(R){const u=z(),b=te(),i=re(),k=V(()=>u.query.iframe==="true"),_=I(null),C=I(!1),g=V(()=>u.params.id&&u.params.id!=="new"),w=V(()=>g.value?Number(u.params.id):null),t=M({name:"",description:"",price:0,compareAtPrice:void 0,sku:"",barcode:"",quantity:0,status:"active",categoryId:void 0,brandId:void 0,images:[]}),m=M({name:"",price:""}),$=[{title:"Активный",value:"active"},{title:"Черновик",value:"draft"}],D=I([{id:1,name:"Одежда"},{id:2,name:"Обувь"},{id:3,name:"Аксессуары"}]),E=I([{id:1,name:"Nike"},{id:2,name:"Adidas"},{id:3,name:"Puma"}]);K(async()=>{if(g.value&&w.value){C.value=!0;const d=await i.fetchProductById(w.value);d&&(t.name=d.name,t.description=d.description,t.price=d.price,t.compareAtPrice=d.compareAtPrice,t.sku=d.sku||"",t.barcode=d.barcode||"",t.quantity=d.quantity,t.status=d.status,t.categoryId=d.categoryId,t.brandId=d.brandId,t.images=d.images||[]),C.value=!1}});const L=()=>{let d=!0;return m.name="",m.price="",t.name.trim()||(m.name="Название обязательно",d=!1),(!t.price||t.price<=0)&&(m.price="Укажите цену",d=!1),d},T=async()=>{if(!L())return;const d={name:t.name,description:t.description,price:t.price,compareAtPrice:t.compareAtPrice,sku:t.sku,barcode:t.barcode,quantity:t.quantity,status:t.status,categoryId:t.categoryId,brandId:t.brandId,images:t.images};let e=!1;g.value&&w.value?e=!!await i.updateProduct(w.value,d):e=!!await i.createProduct(d),e&&(k.value,b.push("/catalog"))},G=d=>{const e=d.target;e.files&&(Array.from(e.files).forEach(l=>{const v=new FileReader;v.onload=A=>{A.target?.result&&t.images.push(A.target.result)},v.readAsDataURL(l)}),e.value="")},J=d=>{t.images.splice(d,1)};return(d,e)=>(r(),n(O,{fluid:"",class:"pa-0 mw-1000"},{default:s(()=>[o("div",ne,[o("div",ue,[k.value?h("",!0):(r(),n(y,{key:0,icon:"mdi-arrow-left",variant:"text",to:"/catalog",class:"mr-2"})),o("h1",me,U(g.value?"Редактировать товар":"Добавить товар"),1)]),o("div",ce,[k.value?h("",!0):(r(),n(y,{key:0,variant:"outlined",color:"black",class:"text-none font-weight-bold",rounded:"lg",to:"/catalog"},{default:s(()=>[...e[11]||(e[11]=[x(" Отмена ",-1)])]),_:1})),a(y,{color:"#37E23F",class:"text-white text-none font-weight-bold",elevation:"0",rounded:"lg",loading:q(i).loading,onClick:T},{default:s(()=>[...e[12]||(e[12]=[x(" Сохранить ",-1)])]),_:1},8,["loading"])])]),q(i).error?(r(),n(W,{key:0,type:"error",class:"mb-4",closable:""},{default:s(()=>[x(U(q(i).error),1)]),_:1})):h("",!0),g.value&&C.value?(r(),P("div",pe,[a(Z,{indeterminate:"",color:"#4527A0",size:"48"})])):(r(),n(F,{key:2},{default:s(()=>[a(c,{cols:"12",md:"8"},{default:s(()=>[a(p,{class:"rounded-xl border mb-6",flat:""},{default:s(()=>[o("div",fe,[e[13]||(e[13]=o("label",{class:"text-caption font-weight-bold text-grey-darken-1 mb-2 d-block"},"Название *",-1)),a(f,{modelValue:t.name,"onUpdate:modelValue":e[0]||(e[0]=l=>t.name=l),placeholder:"Например, Футболка oversize",variant:"outlined",density:"comfortable","hide-details":"auto",class:"mb-6","error-messages":m.name},null,8,["modelValue","error-messages"]),e[14]||(e[14]=o("label",{class:"text-caption font-weight-bold text-grey-darken-1 mb-2 d-block"},"Описание",-1)),a(H,{modelValue:t.description,"onUpdate:modelValue":e[1]||(e[1]=l=>t.description=l),placeholder:"Расскажите о товаре...",variant:"outlined",density:"comfortable",rows:"6","hide-details":"auto"},null,8,["modelValue"])])]),_:1}),a(p,{class:"rounded-xl border mb-6",flat:""},{default:s(()=>[o("div",be,[e[17]||(e[17]=o("h3",{class:"text-body-1 font-weight-bold mb-4"},"Медиафайлы",-1)),t.images.length>0?(r(),P("div",ge,[(r(!0),P(Q,null,X(t.images,(l,v)=>(r(),P("div",{key:v,class:"position-relative"},[a(ae,{src:l,width:"100",height:"100",cover:"",class:"rounded-lg border"},null,8,["src"]),a(y,{icon:"",size:"x-small",color:"red",class:"position-absolute",style:{top:"-8px",right:"-8px"},onClick:A=>J(v)},{default:s(()=>[a(N,{icon:"mdi-close",size:"12"})]),_:1},8,["onClick"])]))),128))])):h("",!0),a(Y,{color:"grey-lighten-5",class:"border dashed-border rounded-lg d-flex flex-column align-center justify-center pa-8 cursor-pointer",height:"160",onClick:e[2]||(e[2]=l=>_.value?.click())},{default:s(()=>[o("div",ve,[a(y,{size:"small",variant:"flat",color:"white",class:"text-none border"},{default:s(()=>[...e[15]||(e[15]=[x("Добавить файл",-1)])]),_:1})]),e[16]||(e[16]=o("div",{class:"text-caption text-grey"},"Принимаем изображения (JPG, PNG, WebP)",-1))]),_:1}),o("input",{type:"file",ref_key:"fileInput",ref:_,class:"d-none",accept:"image/*",multiple:"",onChange:G},null,544)])]),_:1}),a(p,{class:"rounded-xl border mb-6",flat:""},{default:s(()=>[o("div",ye,[e[20]||(e[20]=o("h3",{class:"text-body-1 font-weight-bold mb-4"},"Цены",-1)),a(F,null,{default:s(()=>[a(c,{cols:"6"},{default:s(()=>[e[18]||(e[18]=o("label",{class:"text-caption font-weight-bold text-grey-darken-1 mb-2 d-block"},"Цена *",-1)),a(f,{modelValue:t.price,"onUpdate:modelValue":e[3]||(e[3]=l=>t.price=l),modelModifiers:{number:!0},prefix:"₽",placeholder:"0",type:"number",variant:"outlined",density:"comfortable","hide-details":"auto","error-messages":m.price},null,8,["modelValue","error-messages"])]),_:1}),a(c,{cols:"6"},{default:s(()=>[e[19]||(e[19]=o("label",{class:"text-caption font-weight-bold text-grey-darken-1 mb-2 d-block"},"Цена до скидки",-1)),a(f,{modelValue:t.compareAtPrice,"onUpdate:modelValue":e[4]||(e[4]=l=>t.compareAtPrice=l),modelModifiers:{number:!0},prefix:"₽",placeholder:"0",type:"number",variant:"outlined",density:"comfortable","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})])]),_:1}),a(p,{class:"rounded-xl border mb-6",flat:""},{default:s(()=>[o("div",xe,[e[24]||(e[24]=o("h3",{class:"text-body-1 font-weight-bold mb-4"},"Учет товаров",-1)),a(F,null,{default:s(()=>[a(c,{cols:"6"},{default:s(()=>[e[21]||(e[21]=o("label",{class:"text-caption font-weight-bold text-grey-darken-1 mb-2 d-block"},"Артикул (SKU)",-1)),a(f,{modelValue:t.sku,"onUpdate:modelValue":e[5]||(e[5]=l=>t.sku=l),variant:"outlined",density:"comfortable","hide-details":""},null,8,["modelValue"])]),_:1}),a(c,{cols:"6"},{default:s(()=>[e[22]||(e[22]=o("label",{class:"text-caption font-weight-bold text-grey-darken-1 mb-2 d-block"},"Штрихкод (ISBN, UPC)",-1)),a(f,{modelValue:t.barcode,"onUpdate:modelValue":e[6]||(e[6]=l=>t.barcode=l),variant:"outlined",density:"comfortable","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),a(ee,{class:"my-4"}),o("div",Ve,[e[23]||(e[23]=o("span",{class:"text-body-2"},"Количество на складе",-1)),a(f,{modelValue:t.quantity,"onUpdate:modelValue":e[7]||(e[7]=l=>t.quantity=l),modelModifiers:{number:!0},type:"number",variant:"outlined",density:"compact",style:{"max-width":"120px"},"hide-details":""},null,8,["modelValue"])])])]),_:1})]),_:1}),a(c,{cols:"12",md:"4"},{default:s(()=>[a(p,{class:"rounded-xl border mb-6",flat:""},{default:s(()=>[o("div",ke,[e[25]||(e[25]=o("h3",{class:"text-body-1 font-weight-bold mb-4"},"Статус",-1)),a(B,{modelValue:t.status,"onUpdate:modelValue":e[8]||(e[8]=l=>t.status=l),items:$,"item-title":"title","item-value":"value",variant:"outlined",density:"comfortable","hide-details":""},{selection:s(({item:l})=>[a(N,{color:l.raw.value==="active"?"green":"grey",icon:"mdi-circle-small",class:"mr-2"},null,8,["color"]),x(" "+U(l.title),1)]),_:1},8,["modelValue"])])]),_:1}),a(p,{class:"rounded-xl border mb-6",flat:""},{default:s(()=>[o("div",we,[e[26]||(e[26]=o("h3",{class:"text-body-1 font-weight-bold mb-4"},"Организация",-1)),e[27]||(e[27]=o("label",{class:"text-caption font-weight-bold text-grey-darken-1 mb-2 d-block"},"Категория",-1)),a(B,{modelValue:t.categoryId,"onUpdate:modelValue":e[9]||(e[9]=l=>t.categoryId=l),items:D.value,"item-title":"name","item-value":"id",label:"Выбрать категорию",variant:"outlined",density:"comfortable","hide-details":"",class:"mb-4",clearable:""},null,8,["modelValue","items"]),e[28]||(e[28]=o("label",{class:"text-caption font-weight-bold text-grey-darken-1 mb-2 d-block"},"Бренд / Производитель",-1)),a(B,{modelValue:t.brandId,"onUpdate:modelValue":e[10]||(e[10]=l=>t.brandId=l),items:E.value,"item-title":"name","item-value":"id",label:"Выбрать бренд",variant:"outlined",density:"comfortable","hide-details":"",class:"mb-4",clearable:""},null,8,["modelValue","items"])])]),_:1})]),_:1})]),_:1}))]),_:1}))}}),S=ie(Ie,[["__scopeId","data-v-aaeab511"]]),he={class:"pa-4"},Ae=j({__name:"ProductFormView",setup(R){const u=z(),b=V(()=>u.query.iframe==="true"),i=V(()=>b.value?"div":de);return(k,_)=>(r(),n(le(i.value),null,{default:s(()=>[b.value?(r(),n(oe,{key:0,class:"bg-white"},{default:s(()=>[a(se,null,{default:s(()=>[o("div",he,[a(S)])]),_:1})]),_:1})):(r(),n(S,{key:1}))]),_:1}))}});export{Ae as default};
