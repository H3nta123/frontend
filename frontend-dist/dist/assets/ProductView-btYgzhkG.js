import{E,m as _,d as O,F as k,$ as q,ad as J,B as K,c as x,w as s,a,s as y,aj as Z,C as h,K as G,L as H,g as b,e as Q,f as T,n as N,j as W,Z as X,b as t,ak as A,v as I,ac as R,y as d,x as j,h as w,t as Y,a6 as ee,J as F,I as te,V as ae,o as u,D as le,O as oe}from"./index-BaQgaqTq.js";import{u as se,S as re}from"./ShopLayout-BNRZgYQN.js";import{a as ne,u as ie,_ as de}from"./_plugin-vue_export-helper-C_lUuKz4.js";const ue=E("reviews",()=>{const p=_([]),V=_(!1),C=l=>p.value.filter(n=>n.productId===l);return{reviews:p,loading:V,getReviewsByProductId:C,getAverageRating:l=>{const n=C(l);if(n.length===0)return 0;const c=n.reduce((o,v)=>o+v.rating,0);return Math.round(c/n.length*10)/10},getReviewsCount:l=>p.value.filter(n=>n.productId===l).length,addReview:async l=>{V.value=!0,await new Promise(c=>setTimeout(c,500));const n={id:Math.max(...p.value.map(c=>c.id),0)+1,productId:l.productId,authorName:l.authorName,rating:l.rating,text:l.text,createdAt:new Date().toISOString()};return p.value.unshift(n),V.value=!1,n}}}),ce={key:0,class:"d-flex justify-center py-16"},me={class:"d-flex flex-column h-100"},ve={class:"d-flex align-center mb-3"},ge={class:"d-flex align-center mb-6"},pe={key:0,class:"text-h6 text-decoration-line-through text-grey ml-4"},fe={class:"d-flex align-center gap-4 mb-6"},xe={class:"d-flex align-center border rounded-lg"},ye={class:"px-4 font-weight-bold"},he={class:"d-flex flex-wrap gap-4 mt-auto"},be={class:"d-flex align-center"},we={class:"d-flex align-center"},_e={class:"d-flex justify-space-between align-center mb-6"},Ve={class:"mb-4"},Ce={class:"d-flex gap-2"},ke={key:1},Re={class:"d-flex align-center mb-2"},Se={class:"font-weight-bold"},Ne={class:"font-weight-bold text-body-2"},Ie={class:"text-caption text-grey"},ze={class:"text-body-2 mb-0"},Ae={key:2,class:"text-center py-8"},Pe=O({__name:"ProductView",setup(p){const V=J(),C=ne(),P=ie(),B=se(),g=ue(),l=k(()=>C.settings),n=k(()=>C.isDarkTheme),c=_(!0),o=_(null),v=_(1),S=_(!1),i=q({authorName:"",rating:5,text:""}),f=k(()=>Number(V.params.id)),z=k(()=>g.getReviewsByProductId(f.value)),U=k(()=>[{title:"Главная",to:"/shop/preview"},{title:"Каталог",to:"/shop/catalog"},{title:o.value?.name||"Товар",disabled:!0}]);K(async()=>{c.value=!0;const m=await P.fetchProductById(f.value);o.value=m,c.value=!1});const D=m=>new Intl.NumberFormat("ru-RU").format(m)+" ₽",$=m=>new Date(m).toLocaleDateString("ru-RU",{day:"numeric",month:"short",year:"numeric"}),L=()=>{if(o.value){for(let m=0;m<v.value;m++)B.addItem({id:o.value.id,name:o.value.name,price:o.value.price,image:o.value.images?.[0]});v.value=1}},M=async()=>{!i.authorName.trim()||!i.text.trim()||(await g.addReview({productId:f.value,authorName:i.authorName,rating:i.rating,text:i.text}),i.authorName="",i.rating=5,i.text="",S.value=!1)};return(m,e)=>(u(),x(re,null,{default:s(()=>[a(ae,{class:"py-8 mw-1200"},{default:s(()=>[a(Z,{items:U.value,class:"pa-0 mb-6"},{divider:s(()=>[a(h,{icon:"mdi-chevron-right",size:"small"})]),_:1},8,["items"]),c.value?(u(),y("div",ce,[a(G,{indeterminate:"",color:l.value.primaryColor,size:"48"},null,8,["color"])])):o.value?(u(),y(F,{key:2},[a(Q,null,{default:s(()=>[a(T,{cols:"12",md:"6"},{default:s(()=>[a(N,{class:"rounded-xl",flat:""},{default:s(()=>[a(W,{color:n.value?"grey-darken-3":"grey-lighten-4",height:"500",class:"rounded-xl d-flex align-center justify-center"},{default:s(()=>[o.value.images&&o.value.images.length>0?(u(),x(X,{key:0,src:o.value.images[0],height:"500",cover:"",class:"rounded-xl"},null,8,["src"])):(u(),x(h,{key:1,size:"120",color:n.value?"grey-darken-1":"grey-lighten-2"},{default:s(()=>[...e[8]||(e[8]=[b(" mdi-image-outline ",-1)])]),_:1},8,["color"]))]),_:1},8,["color"])]),_:1})]),_:1}),a(T,{cols:"12",md:"6"},{default:s(()=>[t("div",me,[t("div",ve,[a(A,{"model-value":I(g).getAverageRating(f.value),color:"amber","half-increments":"",readonly:"",density:"compact",size:"small"},null,8,["model-value"]),t("span",{class:"text-body-2 ml-2",style:R({color:l.value.textColor})},d(I(g).getAverageRating(f.value))+" ("+d(I(g).getReviewsCount(f.value))+" отзывов) ",5)]),t("h1",{class:"text-h4 font-weight-bold mb-4",style:R({color:l.value.textColor})},d(o.value.name),5),t("div",ge,[t("span",{class:"text-h4 font-weight-bold",style:R({color:l.value.primaryColor})},d(D(o.value.price)),5),o.value.compareAtPrice&&o.value.compareAtPrice>o.value.price?(u(),y("span",pe,d(D(o.value.compareAtPrice)),1)):j("",!0)]),t("p",{class:"text-body-1 mb-6",style:R({color:l.value.textColor,opacity:.8})},d(o.value.description||"Нет описания"),5),t("div",fe,[t("div",xe,[a(w,{icon:"mdi-minus",variant:"text",size:"small",disabled:v.value<=1,onClick:e[0]||(e[0]=r=>v.value--)},null,8,["disabled"]),t("span",ye,d(v.value),1),a(w,{icon:"mdi-plus",variant:"text",size:"small",onClick:e[1]||(e[1]=r=>v.value++)})]),a(w,{size:"x-large",rounded:"lg",color:l.value.primaryColor,class:"text-white text-none font-weight-bold px-10 flex-grow-1",disabled:o.value.status!=="active",onClick:L},{default:s(()=>[a(h,{icon:"mdi-cart-plus",class:"mr-2"}),e[9]||(e[9]=b(" В корзину ",-1))]),_:1},8,["color","disabled"])]),t("div",he,[t("div",be,[a(h,{icon:"mdi-truck-delivery-outline",color:l.value.primaryColor,class:"mr-2"},null,8,["color"]),e[10]||(e[10]=t("span",{class:"text-body-2"},"Быстрая доставка",-1))]),t("div",we,[a(h,{icon:"mdi-shield-check-outline",color:l.value.primaryColor,class:"mr-2"},null,8,["color"]),e[11]||(e[11]=t("span",{class:"text-body-2"},"Гарантия качества",-1))])])])]),_:1})]),_:1}),a(N,{class:"rounded-xl mt-8 pa-6",flat:"",color:n.value?"grey-darken-4":"grey-lighten-5"},{default:s(()=>[t("div",_e,[t("h2",{class:"text-h6 font-weight-bold",style:R({color:l.value.textColor})}," Отзывы ("+d(z.value.length)+") ",5),a(w,{color:l.value.primaryColor,variant:"flat",class:"text-white text-none font-weight-bold",rounded:"lg",onClick:e[2]||(e[2]=r=>S.value=!0)},{default:s(()=>[...e[12]||(e[12]=[b(" Написать отзыв ",-1)])]),_:1},8,["color"])]),S.value?(u(),x(N,{key:0,class:"rounded-xl pa-5 mb-6",flat:""},{default:s(()=>[e[16]||(e[16]=t("h3",{class:"font-weight-bold mb-4"},"Новый отзыв",-1)),a(Y,{modelValue:i.authorName,"onUpdate:modelValue":e[3]||(e[3]=r=>i.authorName=r),label:"Ваше имя",variant:"outlined",density:"compact","hide-details":"",class:"mb-4"},null,8,["modelValue"]),t("div",Ve,[e[13]||(e[13]=t("label",{class:"text-body-2 font-weight-bold mb-2 d-block"},"Оценка",-1)),a(A,{modelValue:i.rating,"onUpdate:modelValue":e[4]||(e[4]=r=>i.rating=r),color:"amber",hover:"",size:"large"},null,8,["modelValue"])]),a(ee,{modelValue:i.text,"onUpdate:modelValue":e[5]||(e[5]=r=>i.text=r),label:"Ваш отзыв",variant:"outlined",density:"compact",rows:"3","hide-details":"",class:"mb-4"},null,8,["modelValue"]),t("div",Ce,[a(w,{color:l.value.primaryColor,variant:"flat",class:"text-white text-none font-weight-bold",rounded:"lg",loading:I(g).loading,onClick:M},{default:s(()=>[...e[14]||(e[14]=[b(" Отправить ",-1)])]),_:1},8,["color","loading"]),a(w,{variant:"text",class:"text-none",onClick:e[6]||(e[6]=r=>S.value=!1)},{default:s(()=>[...e[15]||(e[15]=[b("Отмена",-1)])]),_:1})])]),_:1})):j("",!0),z.value.length>0?(u(),y("div",ke,[(u(!0),y(F,null,te(z.value,r=>(u(),x(N,{key:r.id,class:"rounded-lg pa-4 mb-3",flat:""},{default:s(()=>[t("div",Re,[a(le,{color:"grey-lighten-3",size:"36",class:"mr-3"},{default:s(()=>[t("span",Se,d(r.authorName.charAt(0)),1)]),_:2},1024),t("div",null,[t("div",Ne,d(r.authorName),1),a(A,{"model-value":r.rating,color:"amber",readonly:"",density:"compact",size:"x-small"},null,8,["model-value"])]),a(oe),t("span",Ie,d($(r.createdAt)),1)]),t("p",ze,d(r.text),1)]),_:2},1024))),128))])):(u(),y("div",Ae,[a(h,{icon:"mdi-comment-outline",size:"48",color:"grey-lighten-1",class:"mb-2"}),e[17]||(e[17]=t("p",{class:"text-body-2 text-grey"},"Пока нет отзывов. Будьте первым!",-1))]))]),_:1},8,["color"])],64)):(u(),x(H,{key:1,type:"warning",class:"mb-4"},{default:s(()=>[...e[7]||(e[7]=[b(" Товар не найден ",-1)])]),_:1}))]),_:1})]),_:1}))}}),je=de(Pe,[["__scopeId","data-v-4cb0d4c1"]]);export{je as default};
