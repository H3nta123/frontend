import{M as F}from"./MainLayout-cmQcMttl.js";import{s as S}from"./sites-CZD5WQuG.js";import{a as M,_ as R}from"./_plugin-vue_export-helper-C_lUuKz4.js";import{G as h,d as L,m as d,$ as j,B as G,c as y,w as l,b as r,a as t,g as o,h as i,s as H,I as J,J as O,e as Q,n as V,N as D,P as E,t as z,Q as B,O as P,R as $,C as w,A as q,o as v,f as K,a0 as W,y as C,a1 as X,H as Y,D as Z,i as ee,x as ae}from"./index-BaQgaqTq.js";const te={async createPayment(g){return await h.post("/me/payment/create",g)},async createBasketPayment(g){return await h.post("/basket/payment",g)}},le={class:"d-flex justify-space-between align-center mb-6"},ne=L({__name:"StoresView",setup(g){q();const f=M(),c=d(!1),u=d(!1),b=d(!1),x=d(!1),k=d(!1),p=d(null),m=d([]),s=j({name:"",subdomain:""}),I=async()=>{k.value=!0;try{const e=((await S.getDashboard()).sites||[]).map(a=>({id:a.id,name:a.config?.name||a.name||"Магазин",subdomain:a.subdomain,active:a.is_active||a.active||!1,pattern:a.pattern||"minimal-light",config:a.config||{}}));m.value=e,f.settings.subdomain&&(m.value.find(A=>A.subdomain===f.settings.subdomain)||m.value.unshift({id:"local-current",name:f.settings.name,subdomain:f.settings.subdomain,active:!0,pattern:"minimal-light",config:f.settings}))}catch(n){console.error("Ошибка загрузки магазинов",n)}finally{k.value=!1}};G(()=>{I()});const N=()=>{s.name="",s.subdomain="",c.value=!0},_=async()=>{x.value=!0;try{const n={subdomain:s.subdomain,pattern:"minimal-light",config:{name:s.name,subdomain:s.subdomain}},e=await S.saveSite(n);c.value=!1,e&&e.id&&(m.value.unshift({id:e.id,name:s.name,subdomain:s.subdomain,active:!1,pattern:n.pattern,config:n.config}),p.value=e.id,u.value=!0)}catch(n){console.error(n),alert(n.message||"Ошибка при создании магазина. Возможно поддомен занят.")}finally{x.value=!1}},T=n=>{p.value=n,u.value=!0},U=async()=>{if(p.value){b.value=!0;try{const n=m.value.find(a=>a.id===p.value),e=await te.createPayment({site_id:p.value,description:`Оплата магазина: ${n?.name||"Без названия"}`,return_url:window.location.origin+"/stores"});if(e.confirmation_url){window.location.href=e.confirmation_url;return}u.value=!1,alert("Оплата инициирована.")}catch(n){console.error("Payment error:",n),alert(n.message||"Ошибка оплаты")}finally{b.value=!1}}};return(n,e)=>(v(),y(F,null,{default:l(()=>[r("div",le,[e[7]||(e[7]=r("h1",{class:"text-h4 font-weight-bold"},"Мои магазины",-1)),t(i,{color:"#2A1A8E","prepend-icon":"mdi-plus",class:"text-none text-white px-6",rounded:"lg",onClick:N},{default:l(()=>[...e[6]||(e[6]=[o(" Создать магазин ",-1)])]),_:1})]),t(Q,null,{default:l(()=>[(v(!0),H(O,null,J(m.value,a=>(v(),y(K,{cols:"12",md:"4",key:a.id},{default:l(()=>[t(V,{class:"rounded-xl border hover-card",elevation:"0"},{default:l(()=>[t(W,{class:"pa-4"},{prepend:l(()=>[t(Z,{color:"#E8EAF6",size:"48",rounded:"lg"},{default:l(()=>[t(w,{icon:"mdi-store",color:"#2A1A8E",size:"28"})]),_:1})]),append:l(()=>[t(Y,{size:"small",color:a.active?"green":"grey",label:"",class:"font-weight-bold"},{default:l(()=>[o(C(a.active?"Активен":"Неактивен"),1)]),_:2},1032,["color"])]),default:l(()=>[t(D,{class:"font-weight-bold"},{default:l(()=>[o(C(a.name),1)]),_:2},1024),t(X,{class:"text-caption mt-1"},{default:l(()=>[o(C(a.subdomain)+".localhost",1)]),_:2},1024)]),_:2},1024),t(ee),t(B,{class:"pa-4 pt-2"},{default:l(()=>[t(i,{variant:"text",size:"small",class:"text-none",color:"grey-darken-1",href:`http://${a.subdomain}.localhost:3000/shop/preview`,target:"_blank"},{default:l(()=>[t(w,{icon:"mdi-open-in-new",size:"small",class:"mr-1"}),e[8]||(e[8]=o(" Открыть ",-1))]),_:1},8,["href"]),t(P),t(i,{variant:"flat",class:"text-none font-weight-bold bg-grey-lighten-4",color:"#2A1A8E",rounded:"lg",to:`/builder?storeId=${a.id}`},{default:l(()=>[...e[9]||(e[9]=[o(" Конструктор ",-1)])]),_:1},8,["to"]),a.active?ae("",!0):(v(),y(i,{key:0,variant:"flat",class:"text-none font-weight-bold ml-2",color:"orange-darken-1",rounded:"lg",onClick:A=>T(a.id)},{default:l(()=>[...e[10]||(e[10]=[o(" Оплатить ",-1)])]),_:1},8,["onClick"]))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),t($,{modelValue:c.value,"onUpdate:modelValue":e[3]||(e[3]=a=>c.value=a),"max-width":"500"},{default:l(()=>[t(V,{class:"rounded-xl pa-4"},{default:l(()=>[t(D,{class:"font-weight-bold text-h5 px-4 pt-4"},{default:l(()=>[...e[11]||(e[11]=[o("Новый магазин",-1)])]),_:1}),t(E,{class:"px-4"},{default:l(()=>[e[12]||(e[12]=r("p",{class:"text-body-2 text-grey-darken-1 mb-6"},"Создайте новый магазин и начните продавать.",-1)),e[13]||(e[13]=r("label",{class:"font-weight-bold text-caption mb-1 d-block"},"Название магазина",-1)),t(z,{modelValue:s.name,"onUpdate:modelValue":e[0]||(e[0]=a=>s.name=a),variant:"outlined",density:"compact",placeholder:"Мой крутой магазин",class:"mb-4",rounded:"lg"},null,8,["modelValue"]),e[14]||(e[14]=r("label",{class:"font-weight-bold text-caption mb-1 d-block"},"Поддомен",-1)),t(z,{modelValue:s.subdomain,"onUpdate:modelValue":e[1]||(e[1]=a=>s.subdomain=a),variant:"outlined",density:"compact",placeholder:"myshop",suffix:".localhost",class:"mb-4",rounded:"lg"},null,8,["modelValue"])]),_:1}),t(B,{class:"px-4 pb-4"},{default:l(()=>[t(P),t(i,{variant:"text",class:"text-none text-grey",rounded:"lg",onClick:e[2]||(e[2]=a=>c.value=!1)},{default:l(()=>[...e[15]||(e[15]=[o("Отмена",-1)])]),_:1}),t(i,{color:"#2A1A8E",variant:"flat",class:"text-none text-white px-6",rounded:"lg",onClick:_,loading:x.value},{default:l(()=>[...e[16]||(e[16]=[o(" Создать ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t($,{modelValue:u.value,"onUpdate:modelValue":e[5]||(e[5]=a=>u.value=a),"max-width":"400"},{default:l(()=>[t(V,{class:"rounded-xl pa-4 text-center"},{default:l(()=>[t(E,{class:"d-flex flex-column align-center pt-8"},{default:l(()=>[t(w,{icon:"mdi-credit-card-outline",size:"64",color:"#2A1A8E",class:"mb-4"}),e[19]||(e[19]=r("h3",{class:"text-h5 font-weight-bold mb-2"},"Требуется оплата",-1)),e[20]||(e[20]=r("p",{class:"text-body-2 text-grey mb-6"},"Чтобы подключить свой поддомен, необходимо оплатить подписку.",-1)),t(i,{color:"#2A1A8E",variant:"flat",class:"text-none text-white w-100 mb-3",rounded:"lg",height:"48",loading:b.value,onClick:U},{default:l(()=>[...e[17]||(e[17]=[o(" Оплатить 199 ₽ ",-1)])]),_:1},8,["loading"]),t(i,{variant:"text",class:"text-none text-grey",size:"small",onClick:e[4]||(e[4]=a=>u.value=!1)},{default:l(()=>[...e[18]||(e[18]=[o("Отмена",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}}),re=R(ne,[["__scopeId","data-v-aaa163a0"]]);export{re as default};
