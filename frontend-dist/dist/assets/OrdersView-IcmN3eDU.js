import{M as U}from"./MainLayout-cmQcMttl.js";import{E as R,m as x,F as M,G as V,d as q,B as G,c as y,w as o,b as e,s as p,a as r,x as h,v as k,H as P,g as f,y as l,I as O,J as S,K as H,L as J,n as E,C as K,M as Q,N as W,O as T,h as N,i as I,P as X,Q as Y,R as Z,o as i,S as ee,T as te,U as se,W as z,X as F,Y as le}from"./index-BaQgaqTq.js";import{_ as ae}from"./_plugin-vue_export-helper-C_lUuKz4.js";const re=R("orders",()=>{const b=x([]),v=x(null),g=x(!1),c=x(null),a=x([]),j=M(()=>b.value.filter(n=>n.status==="new").length),$=M(()=>{const n={new:[],processing:[],shipped:[],delivered:[],cancelled:[]};return b.value.forEach(u=>{n[u.status].push(u)}),n});async function A(){g.value=!0,c.value=null;try{const n=await V.get("/orders");b.value=n.data}catch(n){c.value=n.message||"Ошибка загрузки заказов",console.error("fetchOrders error:",n)}finally{g.value=!1}}async function w(n){try{const u=await V.get(`/orders/${n}`);return v.value=u,u}catch(u){return c.value=u.message||"Ошибка загрузки заказа",null}}async function B(n,u){g.value=!0,c.value=null;try{await V.patch(`/orders/${n}`,{status:u});const _=b.value.findIndex(C=>C.id===n);return _!==-1&&(b.value[_].status=u),!0}catch(_){return c.value=_.message||"Ошибка обновления статуса",!1}finally{g.value=!1}}async function D(n){g.value=!0,c.value=null;try{const u=await V.post("/orders",n);return b.value.unshift(u),u}catch(u){return c.value=u.message||"Ошибка создания заказа",null}finally{g.value=!1}}async function L(){try{const n=await V.get("/me/orders/statuses");return a.value=n,n}catch(n){return c.value=n.message||"Ошибка загрузки статусов",console.error("fetchOrderStatuses error:",n),[]}}return{orders:b,currentOrder:v,loading:g,error:c,statuses:a,newOrdersCount:j,ordersByStatus:$,fetchOrders:A,fetchOrderById:w,updateOrderStatus:B,createOrder:D,fetchOrderStatuses:L}}),ne={class:"d-flex justify-space-between align-center mb-8"},oe={class:"d-flex gap-2 mb-6 flex-wrap"},ue={key:0,class:"ml-1"},de={key:0,class:"d-flex justify-center py-16"},ie={class:"py-4 pl-6"},ce={class:"font-weight-bold"},fe={class:"text-caption text-grey"},ve={class:"text-body-2"},ge={class:"font-weight-bold"},pe={class:"text-caption text-grey"},me={class:"font-weight-bold"},ye={class:"text-right pr-6"},be={class:"text-h6 font-weight-bold"},he={class:"text-body-2 mb-1"},xe={class:"text-body-2 mb-1"},we={key:0,class:"text-body-2 mb-1"},_e={key:1,class:"text-body-2 mb-1"},ke={key:2,class:"text-body-2 mb-1"},Ce={class:"text-body-2"},Ve={class:"text-body-2 font-weight-bold"},Oe={class:"d-flex justify-space-between mb-2"},Se={class:"font-weight-bold"},Ne={class:"d-flex justify-space-between mb-2"},Ie={class:"font-weight-bold"},$e={class:"d-flex justify-space-between"},Be={class:"text-h6 font-weight-bold",style:{color:"#4527A0"}},De=q({__name:"OrdersView",setup(b){const v=re(),g=x("all"),c=x(!1),a=x(null),j=[{label:"Все",value:"all"},{label:"Новые",value:"new"},{label:"В обработке",value:"processing"},{label:"Отправлены",value:"shipped"},{label:"Доставлены",value:"delivered"},{label:"Отменены",value:"cancelled"}];G(()=>{v.fetchOrders()});const $=M(()=>g.value==="all"?v.orders:v.orders.filter(d=>d.status===g.value)),A=d=>v.orders.filter(t=>t.status===d).length,w=d=>{switch(d){case"new":return"blue";case"processing":return"orange";case"shipped":return"purple";case"delivered":return"green";case"cancelled":return"grey";default:return"grey"}},B=d=>{switch(d){case"new":return"Новый";case"processing":return"В обработке";case"shipped":return"Отправлен";case"delivered":return"Доставлен";case"cancelled":return"Отменён";default:return d}},D=d=>{switch(d){case"processing":return"Взять в работу";case"shipped":return"Отправить";case"delivered":return"Доставлен";default:return""}},L=d=>{switch(d){case"new":return["processing"];case"processing":return["shipped"];case"shipped":return["delivered"];default:return[]}},n=d=>new Date(d).toLocaleDateString("ru-RU",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}),u=d=>new Intl.NumberFormat("ru-RU").format(d)+" ₽",_=d=>{a.value=d,c.value=!0},C=async(d,t)=>{await v.updateOrderStatus(d,t)};return(d,t)=>(i(),y(U,null,{default:o(()=>[e("div",ne,[t[3]||(t[3]=e("div",null,[e("h1",{class:"text-h5 font-weight-bold text-black"},"Заказы"),e("p",{class:"text-body-2 text-grey-darken-1 mt-1"},"Управление заказами магазина")],-1)),k(v).newOrdersCount>0?(i(),y(P,{key:0,color:"red",class:"font-weight-bold"},{default:o(()=>[f(l(k(v).newOrdersCount)+" новых ",1)]),_:1})):h("",!0)]),e("div",oe,[(i(),p(S,null,O(j,s=>r(P,{key:s.value,color:g.value===s.value?w(s.value):"grey-lighten-3",class:ee([g.value===s.value?"text-white":"text-grey-darken-2","font-weight-bold"]),onClick:m=>g.value=s.value},{default:o(()=>[f(l(s.label)+" ",1),s.value!=="all"?(i(),p("span",ue,"("+l(A(s.value))+")",1)):h("",!0)]),_:2},1032,["color","class","onClick"])),64))]),k(v).loading&&k(v).orders.length===0?(i(),p("div",de,[r(H,{indeterminate:"",color:"#4527A0",size:"48"})])):k(v).error?(i(),y(J,{key:1,type:"error",class:"mb-4",closable:""},{default:o(()=>[f(l(k(v).error),1)]),_:1})):$.value.length===0?(i(),y(E,{key:2,class:"rounded-xl border pa-12 text-center",flat:""},{default:o(()=>[r(K,{icon:"mdi-package-variant",size:"64",color:"grey-lighten-1",class:"mb-4"}),t[4]||(t[4]=e("h3",{class:"text-h6 font-weight-bold mb-2"},"Заказов нет",-1)),t[5]||(t[5]=e("p",{class:"text-body-2 text-grey"},"Новые заказы появятся здесь",-1))]),_:1})):(i(),y(E,{key:3,class:"rounded-xl border",flat:""},{default:o(()=>[r(Q,null,{default:o(()=>[t[8]||(t[8]=e("thead",{class:"bg-grey-lighten-4"},[e("tr",null,[e("th",{class:"text-left font-weight-bold py-4 pl-6"},"Заказ"),e("th",{class:"text-left font-weight-bold"},"Дата"),e("th",{class:"text-left font-weight-bold"},"Клиент"),e("th",{class:"text-left font-weight-bold"},"Сумма"),e("th",{class:"text-left font-weight-bold"},"Статус"),e("th",{class:"text-right font-weight-bold pr-6"},"Действия")])],-1)),e("tbody",null,[(i(!0),p(S,null,O($.value,s=>(i(),p("tr",{key:s.id,class:"hover-row"},[e("td",ie,[e("div",ce,"#"+l(s.orderNumber),1),e("div",fe,l(s.items.length)+" товаров",1)]),e("td",ve,l(n(s.createdAt)),1),e("td",null,[e("div",ge,l(s.customerName),1),e("div",pe,l(s.customerPhone),1)]),e("td",me,l(u(s.total)),1),e("td",null,[r(P,{size:"small",color:w(s.status),label:""},{default:o(()=>[f(l(B(s.status)),1)]),_:2},1032,["color"])]),e("td",ye,[r(N,{variant:"text",color:"blue",class:"text-none font-weight-medium",onClick:m=>_(s)},{default:o(()=>[...t[6]||(t[6]=[f(" Подробнее ",-1)])]),_:1},8,["onClick"]),s.status!=="delivered"&&s.status!=="cancelled"?(i(),y(te,{key:0},{activator:o(({props:m})=>[r(N,le({variant:"text",color:"grey",class:"text-none"},{ref_for:!0},m,{icon:"mdi-dots-vertical"}),null,16)]),default:o(()=>[r(se,{density:"compact"},{default:o(()=>[(i(!0),p(S,null,O(L(s.status),m=>(i(),y(z,{key:m,onClick:Le=>C(s.id,m)},{default:o(()=>[r(F,null,{default:o(()=>[f(l(D(m)),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),r(I),r(z,{onClick:m=>C(s.id,"cancelled")},{default:o(()=>[r(F,{class:"text-red"},{default:o(()=>[...t[7]||(t[7]=[f("Отменить",-1)])]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)):h("",!0)])]))),128))])]),_:1})]),_:1})),r(Z,{modelValue:c.value,"onUpdate:modelValue":t[2]||(t[2]=s=>c.value=s),"max-width":"600"},{default:o(()=>[a.value?(i(),y(E,{key:0,class:"rounded-xl"},{default:o(()=>[r(W,{class:"d-flex align-center pa-6 pb-2"},{default:o(()=>[e("span",be,"Заказ #"+l(a.value.orderNumber),1),r(P,{size:"small",color:w(a.value.status),class:"ml-3",label:""},{default:o(()=>[f(l(B(a.value.status)),1)]),_:1},8,["color"]),r(T),r(N,{icon:"mdi-close",variant:"text",onClick:t[0]||(t[0]=s=>c.value=!1)})]),_:1}),r(I),r(X,{class:"pa-6"},{default:o(()=>[t[16]||(t[16]=e("h4",{class:"text-body-1 font-weight-bold mb-3"},"Клиент",-1)),e("div",he,[t[9]||(t[9]=e("strong",null,"Имя:",-1)),f(" "+l(a.value.customerName),1)]),e("div",xe,[t[10]||(t[10]=e("strong",null,"Телефон:",-1)),f(" "+l(a.value.customerPhone),1)]),a.value.customerEmail?(i(),p("div",we,[t[11]||(t[11]=e("strong",null,"Email:",-1)),f(" "+l(a.value.customerEmail),1)])):h("",!0),a.value.address?(i(),p("div",_e,[t[12]||(t[12]=e("strong",null,"Адрес:",-1)),f(" "+l(a.value.address),1)])):h("",!0),a.value.comment?(i(),p("div",ke,[t[13]||(t[13]=e("strong",null,"Комментарий:",-1)),f(" "+l(a.value.comment),1)])):h("",!0),r(I,{class:"my-4"}),t[17]||(t[17]=e("h4",{class:"text-body-1 font-weight-bold mb-3"},"Товары",-1)),(i(!0),p(S,null,O(a.value.items,s=>(i(),p("div",{key:s.productId,class:"d-flex justify-space-between mb-2"},[e("span",Ce,l(s.name)+" × "+l(s.quantity),1),e("span",Ve,l(u(s.price*s.quantity)),1)]))),128)),r(I,{class:"my-4"}),e("div",Oe,[t[14]||(t[14]=e("span",null,"Товары:",-1)),e("span",Se,l(u(a.value.subtotal)),1)]),e("div",Ne,[e("span",null,"Доставка ("+l(a.value.deliveryMethod)+"):",1),e("span",Ie,l(a.value.deliveryPrice===0?"Бесплатно":u(a.value.deliveryPrice)),1)]),e("div",$e,[t[15]||(t[15]=e("span",{class:"text-h6 font-weight-bold"},"Итого:",-1)),e("span",Be,l(u(a.value.total)),1)])]),_:1}),r(I),r(Y,{class:"pa-6"},{default:o(()=>[r(N,{variant:"text",class:"text-none",onClick:t[1]||(t[1]=s=>c.value=!1)},{default:o(()=>[...t[18]||(t[18]=[f("Закрыть",-1)])]),_:1}),r(T),a.value.status!=="delivered"&&a.value.status!=="cancelled"?(i(!0),p(S,{key:0},O(L(a.value.status),s=>(i(),y(N,{key:s,color:w(s),variant:"flat",class:"text-white text-none font-weight-bold",rounded:"lg",onClick:m=>{C(a.value.id,s),c.value=!1}},{default:o(()=>[f(l(D(s)),1)]),_:2},1032,["color","onClick"]))),128)):h("",!0)]),_:1})]),_:1})):h("",!0)]),_:1},8,["modelValue"])]),_:1}))}}),Ee=ae(De,[["__scopeId","data-v-79804300"]]);export{Ee as default};
